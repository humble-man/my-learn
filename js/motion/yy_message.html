<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>运动应用—留言</title>
		<style type="text/css">
			#list{
				width: 300px;
				height: 300px;
				border: 1px solid #000;
				margin:20px auto;
				padding: 0;
			}
			#list div{
				border-bottom: 1px dashed #000;
				overflow: hidden;
				filter: alpha(opacity:0);
				opacity: 0;
			}
		</style>
		<script type="text/javascript">
			
			
			//获取运动物体的属性的值   例如：width 值    obj（需要运动的物体对象）   shuxingz(属性的值）
			function getstyle(obj, shuxingz) {
				
				//考虑浏览器的兼容性问题  个别浏览器无法使用currentStyle 获取对象的样式
				if(obj.currentStyle) {
					return obj.currentStyle[shuxingz];
				} else {
					return getComputedStyle(obj, false)[shuxingz];
				}
			}

			//物体的运动方法  obj（要运动的对象）  json（ 对象要运动的属性：对象要运动的属性值）  fn(对象运动后需要执行的下一步方法)）
			function start(obj, json, fn) {
				
				//执行运动方法之前  先清除定时器
				clearInterval(obj.timer);
				
				//给对象设定时器 实现动画
				obj.timer = setInterval(function() {
					var bStop = true;
					
					//循环遍历json 对象   mubiao 就是 json 对象数据中的 属性
					for(var mubiao in json) {
						
						//判断属性是否是  透明度  做浏览器兼容性处理
						if(mubiao == "opacity") {
							var iCu = parseInt(parseFloat(getstyle(obj, '' + mubiao)) * 100);
						} else {
							var iCu = parseInt(getstyle(obj, '' + mubiao));
						}
						
						
						//给动画添加初始速度
						var isSpeed = (json[mubiao] - iCu) / 8;
						
						//速度的取整
						isSpeed = isSpeed > 0 ? Math.ceil(isSpeed) : Math.floor(isSpeed);

						
						//如果当前对象属性值有一个没有达到相应的目标值  则不关闭定时器
						if(iCu != json[mubiao]) {
							
							bStop = false;
						}
						
						
						//动态修改物体的当前属性值 以此实现物体的运动
						if(mubiao == "opacity") {
							obj.style.filter = 'alpha(opacity:' + (iCu + isSpeed) + ')';
							obj.style.opacity = (iCu + isSpeed) / 100;
						} else {
							obj.style[mubiao] = iCu + isSpeed + 'px';
						}
						
						
					}

					//如果对象当前属性值都已经达到目标值,关闭定时器					
					if(bStop) {
						clearInterval(obj.timer);
						if(fn) {
							fn();
						}
					}

				}, 30);
			}

		</script>
	</head>

	<body>
		<input id="txt" type="text" />
		<input type="button" id="btn" value="发布"/>
		<div class="list" id="list">

		</div>
		
		<script type="text/javascript">
				var oDiv = document.getElementById('btn');
				var oTxt = document.getElementById('txt');
				var oUl = document.getElementById('list');
				var oLis = document.getElementsByTagName('div');
				
				oDiv.onclick = function(){
					var oLi = document.createElement('div');
					oLi.innerHTML = oTxt.value;
					if(oLis.length>0){
						oUl.insertBefore(oLi,oLis[1]);
					}else{
						oUl.appendChild(oLi);
					}
					oTxt.value = "";
					
					var liHight = oLi.offsetHeight;
					oLi.style.height = 0;
					start(oLi,{height:liHight},function(){
						start(oLi,{opacity:100});
					});
				}
		</script>
	</body>

</html>