<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			.box {
				width: 100px;
				height: 100px;
				background: red;
				position: absolute;
			}
		</style>
	</head>

	<body>
		<div class="box" id="box"></div>

		<script type="text/javascript">
			
			var oDiv = document.getElementById('box');
			
			//定义速度的初始值,以及物体坐标值,以及定时器名称
			var isSpeedX = 0;
			var isSpeedY = 0;
			var lastX = 0;
			var lastY = 0;
			var timer = null;
			
			
			
			//物体跟随鼠标拖拽的事件  js开始部分
			//鼠标在物体上按下
			oDiv.onmousedown = function(ev){
				
				//处理浏览器兼容性问题
				var oEvent = ev||event;
				
				//鼠标相对物体原点的横向和纵向距离
				var disX = oEvent.clientX - oDiv.offsetLeft;
				var disY = oEvent.clientY - oDiv.offsetTop;
				
				
				//鼠标移动
				document.onmousemove = function(ev){
					
					var oEvent = ev||event;
					
					//定义物体跟随鼠标移动后产生的坐标值
					var l = oEvent.clientX - disX;
					var t = oEvent.clientY - disY;
					
					
					//讲上面产生的坐标值设为物体定位时的上距离和左距离
					oDiv.style.left = l + 'px';
					oDiv.style.top = t + 'px';
					
					//根据物体随鼠标移动后的坐标值减去物体初始坐标值得到速度
					isSpeedX = l - lastX;
					isSpeedY = t - lastY;
					
					//将物体随鼠标移动后产生的坐标值设定为物体的初始位置值
					lastX = l;
					lastY = t;
				}
				
				//鼠标松开后将鼠标移动事件以及松开事件都重置为空  并且执行物体碰撞事件
				document.onmouseup = function(){
					document.onmousemove = null;
					document.onmouseup = null;
					toMove();
				}
				
				
				clearInterval(timer);
			}
			
			//物体跟随鼠标拖拽的事件  js结束
			
			
			
			//碰撞事件 js开始
			function toMove() {
				
				
				//每次执行动画前先清除定时器
				clearInterval(timer);
				
				timer = setInterval(function() {
					
					//纵向速度值逐渐增加(重力)
					isSpeedY+=2;
					
					//定义物体的偏移量  物体当前的左间距 + 横向速度    物体当前上间距  + 纵向速度
					var l = oDiv.offsetLeft + isSpeedX;
					var t = oDiv.offsetTop + isSpeedY;

					//判断物体是否触碰到上下边界  触碰到边界啧改变速度正负值以此改变运动的方向
					if(t >= document.documentElement.clientHeight - oDiv.offsetHeight) {
						isSpeedY *= -0.7;
						isSpeedX *= 0.7;
						t = document.documentElement.clientHeight - oDiv.offsetHeight;
					} else if(t <= 0) {
						isSpeedY *= -0.7;
						isSpeedX *= 0.7;
						t = 0;
					}


					//判断物体是否碰撞到左右边界
					if(l > document.documentElement.clientWidth - oDiv.offsetWidth) {
						isSpeedX *= -0.7;
						l = document.documentElement.clientWidth - oDiv.offsetWidth;
					} else if(l <= 0) {
						isSpeedX *= -0.7;
						l = 0;
					}
					
					
					//当物体的横纵向速度足够小直接将速度设定为0
					if(Math.abs(isSpeedX)<1){
						isSpeedX = 0;
					}
					if(Math.abs(isSpeedY)<1){
						isSpeedY = 0;
					}
					
					
					//判断物体速度是否都为0 且到达底部    是否停止碰撞
					if(isSpeedX==0&&isSpeedY==0&&t==document.documentElement.clientHeight - oDiv.offsetHeight){
						clearInterval(timer);
						console.log('停止碰撞');
					}else{
						oDiv.style.left = l + 'px';
						oDiv.style.top = t + 'px';
					}
					
				}, 30);
			}
			
			//碰撞事件js结束
		</script>
	</body>

</html>